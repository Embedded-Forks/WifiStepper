---
title: Quick Start
menu: quickstart
css:
    - bulma-tooltip
    - bulma-checkradio
    - bulma-switch
bulmajs:
    - notification
prism: true
layout: default
---
{% include helptext.html %}
<h1 class="title is-1">{% mdicon logo %}Quick Start Guide</h1>
<div id="profiles">
    <div class="box properties">
        <div class="level">
            <div class="level-item">
                <span><span class="entry">Voltage:</span> {% raw %}<span class="value" style="color: #c00;">~{{ voltage }} V</span>{% endraw %} <span style="font-size: 0.7rem; color: #666;">(&plusmn; 3 V)</span></span>
            </div>
            <div class="level-item">
                <span><span class="entry">Motor:</span> {% raw %}<span class="value">{{ movement | capitalize }} {{ getdirection | capitalize }}</span>{% endraw %}</span>
            </div>
            <div class="level-item">
                <span><span class="entry">Status:</span> <span v-if="busy" class="value" style="color: #69f;">Busy</span><span v-else class="value" style="color: #0c6;">Idle</span></span>
            </div>
            <div class="level-item">
                <span><span class="entry">Bridge State:</span> <span v-if="hiz" class="value" style="color: #f93;">High Z</span><span v-else class="value">Active</span></span>
            </div>
            <div class="level-item">
                <span><span class="entry">ADC:</span> {% raw %}<span class="value">{{ adc }} V</span>{% endraw %}</span>
            </div>
            <div class="level-item">
                <span><span class="entry">Switch:</span> {% raw %}<span class="value" v-bind:style="this.switch? {'color': '#09f'} : {}">{{ this.switch? 'Closed' : 'Open' }}</span>{% endraw %}</span>
            </div>
        </div>
    </div>
    <div class="notification is-warning" v-if="$cookies.get('help-hookup') !== 'hide'">
        <button class="delete" v-on:click="$cookies.set('help-hookup', 'hide', Infinity)"></button>
        <strong>Note:</strong> If this is your first time working with stepper motors, see the <a class="link" href="/documentation#hookup-guide"><strong>Hookup Guide</strong></a> for help wiring a stepper motor and connecting it to this board.
    </div>
    <div class="notification is-info" v-if="preset.voltage >= 50">
        <strong>Important:</strong> Be sure to take a look at the <a class="link" href="/documentation#high-voltage"><strong>Working with High Voltage</strong></a> tutorial. There are required modifications to this board that are needed prior to using voltages above 50 volts (or things might blow up!).
    </div>
    <div class="title is-4 mode-select">
        <span class="nobreak">
            {% mdicon arrow-right-drop-circle, .inline %}
            Set up
            <span class="select">
                <select v-model="profile" v-bind:style="profile == 'none'? {'color': '#e60000'} : {}" v-on:change="updatepreset">
                    <option value="none">Select...</option>
                    <option value="servo">Servo Control</option>
                    <option value="speed">Speed Control</option>
                    <option value="extstepclock">External Step Clock</option>
                </select>
            </span>
        </span>
        <span class="nobreak">
            on a
            <span class="select">
                <select v-model="preset.size" v-on:change="updatepreset" v-bind:disabled="!hiz">
                    <option value="nema-11">NEMA 11</option>
                    <option value="nema-17">NEMA 17</option>
                    <option value="nema-23">NEMA 23</option>
                    <option value="nema-34">NEMA 34</option>
                </select>
            </span>
        </span>
        <span class="nobreak">
            with
            <span class="select">
                <select v-model="preset.voltage" v-on:change="updatepreset" v-bind:disabled="!hiz">
                    <option value="12">~12 V</option>
                    <option value="24">~24 V</option>
                    <option value="48">~48 V</option>
                    <option value="50">50+ V</option>
                </select>
            </span>
            input
        </span>
        <span class="nobreak">
            under
            <span class="select">
                <select v-model="mode" v-on:change="updatemode" v-bind:disabled="!hiz">
                    <option value="current">Current</option>
                    <option value="voltage">Voltage</option>
                </select>
            </span>
            control:
        </span>
    </div>
    <div v-if="profile == 'none'" style="height: 200px;">
        <div class="has-text-centered" style="max-width: 500px;">
            <div>{% mdicon arrow-up-bold, .title, .is-1 %}</div>
            <div class="title">Select a profile</div>
        </div>
    </div>
    <div v-bind:style="profile == 'servo'? {} : {'display': 'none'}">
        <div class="columns">
            <div class="column has-text-centered is-half">
                <figure class="image">
                    <svg id="servosvg" width="400" height="400" viewbox="-120 -120 240 240">
                        <g style="stroke: #ccc;">
                            <line transform="rotate(0)" x1="0" y1="-80" x2="0" y2="-100" style="stroke-width: 2;" />
                            <line transform="rotate(15)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(30)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(45)" x1="0" y1="-90" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(60)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(75)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(90)" x1="0" y1="-80" x2="0" y2="-100" style="stroke-width: 2;" />
                            <line transform="rotate(105)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(120)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(135)" x1="0" y1="-90" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(150)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(165)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(180)" x1="0" y1="-80" x2="0" y2="-100" style="stroke-width: 2;" />
                            <line transform="rotate(-165)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-150)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-135)" x1="0" y1="-90" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-120)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-105)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-90)" x1="0" y1="-80" x2="0" y2="-100" style="stroke-width: 2;" />
                            <line transform="rotate(-75)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-60)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-45)" x1="0" y1="-90" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-30)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                            <line transform="rotate(-15)" x1="0" y1="-95" x2="0" y2="-100" style="stroke-width: 1;" />
                        </g>
                        <g>
                            <text x="-103" y="0" text-anchor="end" alignment-baseline="middle" style="fill: #ccc; font-size: 0.6rem; user-select: none; pointer-events: none;">90&deg;</text>
                            <text x="0" y="103" text-anchor="middle" alignment-baseline="hanging" style="fill: #ccc; font-size: 0.6rem; user-select: none; pointer-events: none;">180&deg;</text>
                            <text x="103" y="0" text-anchor="start" alignment-baseline="middle" style="fill: #ccc; font-size: 0.6rem; user-select: none; pointer-events: none;">-90&deg;</text>
                        </g>
                        <g v-bind:style="preset.size == 'nema-11' || preset.size == 'nema-17'? {} : {'display': 'none'}">
                            <path d="m-50,-70 h100 l20,20 v100 l-20,20 h-100 l-20,-20 v-100 l20,-20 z" style="stroke: #666; stroke-width: 1.5; fill: #b3b3b3;" />
                            <circle r="40" cx="0" cy="0" style="fill: #ccc; stroke: #666; stroke-width: 1.5;" />
                            <circle r="25" cx="0" cy="0" style="fill: #b3b3b3; stroke: #666; stroke-width: 1.5;" />
                            <circle r="4" cx="-50" cy="-50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="50" cy="-50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="-50" cy="50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="50" cy="50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                        </g>
                        <g v-bind:style="preset.size == 'nema-23' || preset.size == 'nema-34'? {} : {'display': 'none'}">
                            <path d="m-70,-70 h140 v140 h-140 v-140 z" style="stroke: #666; stroke-width: 1.5; fill: #b3b3b3;" />
                            <circle r="50" cx="0" cy="0" style="fill: #ccc; stroke: #666; stroke-width: 1.5;" />
                            <circle r="6" cx="-60" cy="-60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="60" cy="-60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="-60" cy="60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="60" cy="60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                        </g>
                        <g v-bind:transform="'rotate(' + (-getangle) + ')'">
                            <path d="m-9,-12 a15,15,0,1,0,18,0 h-18 z" style="stroke: #000; stroke-width: 2; fill: #800000;" />
                            <path d="m-7,-15 v-35 l-5,0 l12,-25 12,25 -5,0 v35 h-14 z" style="stroke: #000; stroke-width: 1; fill: #008000;" />
                        </g>
                        <g v-bind:transform="'rotate(' + (-setangle) + ')'">
                            <line x1="0" y1="-14" x2="0" y2="-90" style="stroke: #fff; stroke-width: 5;" />
                            <line x1="0" y1="-14" x2="0" y2="-90" style="stroke: #000; stroke-dasharray: 10, 5; stroke-width: 5;" />
                            <rect x="-7" y="-97" height="14" width="14" style="stroke: #000; stroke-width: 1; fill: #66f; cursor: move;" />
                        </g>
                        <g v-if="setangle == 0">
                            <text x="20" y="-87" style="fill: #999; font-weight: bold; font-size: 0.8rem;">&#8672; Grab handle</text>
                        </g>
                    </svg>
                </figure>
            </div>
            <div class="column">
                <div class="field has-addons">
                    <span class="control" style="margin-right: 0px;">
                        <button class="button" style="color: #fff; background-color: #ff5c33;" v-on:click="writeresetpos">{% mdicon restore, .baseline %}Reset Position</button>
                    </span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_resetpos }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <div class="field has-addons">
                    <span class="control"><span class="button is-static">Position:</span></span>
                    <span class="control"><input class="input" style="width: 100px;" type="number" v-model="setangle" step="1" /></span>
                    <span class="control"><input class="input" style="color: #999; width: 100px;" type="number" v-bind:value="getangle" readonly /></span>
                    <span class="control"><span class="button is-static">degrees</span></span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_setgetangle }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <div class="field has-addons">
                    <span class="control"><span class="button is-static">Microstep:</span></span>
                    <span class="control">
                        <span class="select">
                            <select v-model="stepsize" v-on:change="writemotor(['stepsize'])" v-bind:disabled="!hiz">
                                <option value="1">1/1</option>
                                <option value="2">1/2</option>
                                <option value="4">1/4</option>
                                <option value="8">1/8</option>
                                <option value="16">1/16</option>
                                <option value="32" v-if="mode == 'voltage'">1/32</option>
                                <option value="64" v-if="mode == 'voltage'">1/64</option>
                                <option value="128" v-if="mode == 'voltage'">1/128</option>
                            </select>
                        </span>
                    </span>
                    <span class="control">
                        <span class="button is-static">Resolution</span>
                    </span>
                    <span class="control">
                        <button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_stepsize }}">{% mdicon help-circle, .baseline, .inline %}</button>
                    </span>
                </div>
                <div class="field has-addons">
                    <span class="control" style="margin-right: 0px;">
                        <span class="button" style="background-color: #66f;">
                            <input class="is-checkradio is-white" id="reverse1-enable" type="checkbox" v-model="reverse" v-bind:disabled="!hiz" />
                            <label class="is-checkradio-label" for="reverse1-enable">Reverse Wires</label>
                        </span>
                    </span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_reversewires }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <button class="button is-large" style="background-color: #900;" v-on:click="writestop(true, false)">{% mdicon stop, .baseline, .inline %}</button>
            </div>
        </div>
    </div>
    <div v-bind:style="profile == 'speed'? {} : {'display': 'none'}">
        <div class="columns">
            <div class="column has-text-centered is-half">
                <figure class="image">
                    <svg id="speedsvg" width="300" height="300" viewbox="-80 -80 160 160">
                        <g v-bind:style="preset.size == 'nema-11' || preset.size == 'nema-17'? {} : {'display': 'none'}">
                            <path d="m-50,-70 h100 l20,20 v100 l-20,20 h-100 l-20,-20 v-100 l20,-20 z" style="stroke: #666; stroke-width: 1.5; fill: #b3b3b3;" />
                            <circle r="40" cx="0" cy="0" style="fill: #ccc; stroke: #666; stroke-width: 1.5;" />
                            <circle r="25" cx="0" cy="0" style="fill: #b3b3b3; stroke: #666; stroke-width: 1.5;" />
                            <circle r="4" cx="-50" cy="-50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="50" cy="-50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="-50" cy="50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="50" cy="50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                        </g>
                        <g v-bind:style="preset.size == 'nema-23' || preset.size == 'nema-34'? {} : {'display': 'none'}">
                            <path d="m-70,-70 h140 v140 h-140 v-140 z" style="stroke: #666; stroke-width: 1.5; fill: #b3b3b3;" />
                            <circle r="50" cx="0" cy="0" style="fill: #ccc; stroke: #666; stroke-width: 1.5;" />
                            <circle r="6" cx="-60" cy="-60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="60" cy="-60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="-60" cy="60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="60" cy="60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                        </g>
                        <g>
                            <text x="0" y="63" text-anchor="middle" style="fill: #000; font-size: 0.8rem; user-select: none; pointer-events: none;">&#8592;&nbsp;&nbsp;&#8594;</text>
                            <text x="0" y="63" text-anchor="middle" style="fill: #000; font-size: 0.8rem; user-select: none; pointer-events: none;">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+</text>
                        </g>
                        <g v-bind:transform="'rotate(' + (-getangle) + ')'">
                            <path d="m-9,-12 a15,15,0,1,0,18,0 h-18 z" style="stroke: #000; stroke-width: 2; fill: #800000;" />
                            <path d="m-7,-15 v-35 l-5,0 l12,-25 12,25 -5,0 v35 h-14 z" style="stroke: #000; stroke-width: 1; fill: #008000;" />
                        </g>
                    </svg>
                </figure>
                <div>
                    <button class="button is-large" style="color: #fff; background-color: #093;" v-on:click="writespeed('forward')">{% mdicon rotate-left, .baseline, .inline %}F</button>
                    <button class="button is-large" style="background-color: #900;" v-on:click="writestop(speed.hiz, true)">{% mdicon stop, .baseline, .inline %}</button>
                    <button class="button is-large" style="color: #fff; background-color: #093;" v-on:click="writespeed('reverse')">{% mdicon rotate-right, .baseline %}R</button>
                </div>
            </div>
            <div class="column">
                {% raw %}<div v-if="setstepss > maxspeed" class="help is-danger">Warning: Speed is greater than <span style="font-weight: bold;">Max Speed</span> setting (<span style="font-weight: bold;">{{ maxspeed }}</span> steps/sec).</div>{% endraw %}
                <div class="field has-addons">
                    <span class="control"><span class="button is-static">Speed:</span></span>
                    <span class="control"><input class="input" style="width: 100px;" type="number" v-model="setrpm" min="0" max="3000" step="10" /></span>
                    <span class="control"><input class="input" style="color: #999; width: 100px;" type="number" v-bind:value="Math.round(getrpm)" readonly /></span>
                    <span class="control"><span class="button is-static">RPM</span></span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_setgetrpm }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <div class="field has-addons">
                    <span class="control"><span class="button is-static">Microstep:</span></span>
                    <span class="control">
                        <span class="select">
                            <select v-model="stepsize" v-on:change="writemotor(['stepsize'])" v-bind:disabled="!hiz">
                                <option value="1">1/1</option>
                                <option value="2">1/2</option>
                                <option value="4">1/4</option>
                                <option value="8">1/8</option>
                                <option value="16">1/16</option>
                                <option value="32" v-if="mode == 'voltage'">1/32</option>
                                <option value="64" v-if="mode == 'voltage'">1/64</option>
                                <option value="128" v-if="mode == 'voltage'">1/128</option>
                            </select>
                        </span>
                    </span>
                    <span class="control">
                        <span class="button is-static">Resolution</span>
                    </span>
                    <span class="control">
                        <button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_stepsize }}">{% mdicon help-circle, .baseline, .inline %}</button>
                    </span>
                </div>
                <div class="field has-addons">
                    <span class="control">
                        <span class="button is-label">
                            <label class="is-switch-label" for="speed-hizstop">Hard Stop</label>
                            <input class="switch" id="speed-hizstop" type="checkbox" v-model="speed.hiz" />
                            <label class="is-switch-label" for="speed-hizstop">High Z Stop</label>
                        </span>
                    </span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_hizstop }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <div class="field has-addons">
                    <span class="control">
                        <span class="button is-label">
                            <input class="is-checkradio is-white" id="stopswitch-enable" type="checkbox" v-model="speed.stopswitch" v-bind:disabled="!hiz" />
                            <label class="is-checkradio-label" for="stopswitch-enable">Stop on switch</label>
                        </span>
                    </span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_reversewires }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <div class="field has-addons">
                    <span class="control" style="margin-right: 0px;">
                        <span class="button" style="background-color: #66f;">
                            <input class="is-checkradio is-white" id="reverse2-enable" type="checkbox" v-model="reverse" v-bind:disabled="!hiz" />
                            <label class="is-checkradio-label" for="reverse2-enable">Reverse Wires</label>
                        </span>
                    </span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_reversewires }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
            </div>
        </div>
    </div>
    <div v-bind:style="profile == 'extstepclock'? {} : {'display': 'none'}">
        <div class="columns">
            <div class="column has-text-centered is-half">
                <figure class="image">
                    <svg id="speedsvg" width="300" height="300" viewbox="-80 -80 160 160">
                        <g v-bind:style="preset.size == 'nema-11' || preset.size == 'nema-17'? {} : {'display': 'none'}">
                            <path d="m-50,-70 h100 l20,20 v100 l-20,20 h-100 l-20,-20 v-100 l20,-20 z" style="stroke: #666; stroke-width: 1.5; fill: #b3b3b3;" />
                            <circle r="40" cx="0" cy="0" style="fill: #ccc; stroke: #666; stroke-width: 1.5;" />
                            <circle r="25" cx="0" cy="0" style="fill: #b3b3b3; stroke: #666; stroke-width: 1.5;" />
                            <circle r="4" cx="-50" cy="-50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="50" cy="-50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="-50" cy="50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                            <circle r="4" cx="50" cy="50" style="fill: #666; stroke: #808080; stroke-width: 1.5;" />
                        </g>
                        <g v-bind:style="preset.size == 'nema-23' || preset.size == 'nema-34'? {} : {'display': 'none'}">
                            <path d="m-70,-70 h140 v140 h-140 v-140 z" style="stroke: #666; stroke-width: 1.5; fill: #b3b3b3;" />
                            <circle r="50" cx="0" cy="0" style="fill: #ccc; stroke: #666; stroke-width: 1.5;" />
                            <circle r="6" cx="-60" cy="-60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="60" cy="-60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="-60" cy="60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                            <circle r="6" cx="60" cy="60" style="fill: #666; stroke: #808080; stroke-width: 2.5;" />
                        </g>
                        <g>
                            <text x="0" y="63" text-anchor="middle" style="fill: #000; font-size: 0.8rem; user-select: none; pointer-events: none;">&#8592;&nbsp;&nbsp;&#8594;</text>
                            <text x="0" y="63" text-anchor="middle" style="fill: #000; font-size: 0.8rem; user-select: none; pointer-events: none;">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+</text>
                        </g>
                        <g v-bind:transform="'rotate(' + (-getangle) + ')'">
                            <path d="m-9,-12 a15,15,0,1,0,18,0 h-18 z" style="stroke: #000; stroke-width: 2; fill: #800000;" />
                            <path d="m-7,-15 v-35 l-5,0 l12,-25 12,25 -5,0 v35 h-14 z" style="stroke: #000; stroke-width: 1; fill: #008000;" />
                        </g>
                    </svg>
                </figure>
            </div>
            <div class="column">
                <div class="field has-addons">
                    <span class="control" style="margin-right: 0px;">
                        <button class="button" style="color: #fff; background-color: #ff5c33;" v-on:click="writeresetpos">{% mdicon restore, .baseline %}Reset Position</button>
                    </span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_resetpos }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <div class="field has-addons">
                    <span class="control">
                        <span class="button is-label">
                            <label class="is-switch-label" for="extstepclock-direction">Forward</label>
                            <input class="switch" id="extstepclock-direction" type="checkbox" v-model="extstepclock.stepreverse" v-bind:disabled="!hiz" />
                            <label class="is-switch-label" for="extstepclock-direction">Reverse</label>
                        </span>
                    </span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_stepclockdir }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <div class="field has-addons">
                    <span class="control"><span class="button is-static">Microstep:</span></span>
                    <span class="control">
                        <span class="select">
                            <select v-model="stepsize" v-on:change="writemotor(['stepsize'])" v-bind:disabled="!hiz">
                                <option value="1">1/1</option>
                                <option value="2">1/2</option>
                                <option value="4">1/4</option>
                                <option value="8">1/8</option>
                                <option value="16">1/16</option>
                                <option value="32" v-if="mode == 'voltage'">1/32</option>
                                <option value="64" v-if="mode == 'voltage'">1/64</option>
                                <option value="128" v-if="mode == 'voltage'">1/128</option>
                            </select>
                        </span>
                    </span>
                    <span class="control">
                        <span class="button is-static">Resolution</span>
                    </span>
                    <span class="control">
                        <button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_stepsize }}">{% mdicon help-circle, .baseline, .inline %}</button>
                    </span>
                </div>
                <div class="field has-addons">
                    <span class="control" style="margin-right: 0px;">
                        <span class="button" style="background-color: #66f;">
                            <input class="is-checkradio is-white" id="reverse2-enable" type="checkbox" v-model="reverse" v-bind:disabled="!hiz" />
                            <label class="is-checkradio-label" for="reverse2-enable">Reverse Wires</label>
                        </span>
                    </span>
                    <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_reversewires }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                </div>
                <button class="button is-large" style="background-color: #093;" v-on:click="writestepclock">{% mdicon play, .baseline, .inline %}</button>
                <button class="button is-large" style="background-color: #900;" v-on:click="writestop(true, false)">{% mdicon stop, .baseline, .inline %}</button>
            </div>
        </div>
    </div>
    <hr />
    <div class="level warnings">
        <div class="level-left">
            <div class="level-item title is-4">{% mdicon alert, #ff9900, .baseline %}Flags:</div>
        </div>
        <div class="level-item">
            <div class="level">
                <div class="level-item"><span class="tag is-medium" v-bind:class="{'is-error': flags.commanderror}">Command Error</span></div>
                <div class="level-item"><span class="tag is-medium" v-bind:class="{'is-error': flags.overcurrent}">Over Current</span></div>
                <div class="level-item"><span class="tag is-medium" v-bind:class="{'is-error': flags.undervoltage}">Under Voltage</span></div>
                <div class="level-item"><span class="tag is-medium" v-bind:class="{'is-warning': flags.thermalwarning, 'is-error': flags.thermalshutdown}">Thermal</span></div>
            </div>
        </div>
        <div class="level-right">
            <div class="level-item"><button class="button is-dark" id="error-clear" v-on:click="readstatus(true)">Clear Flags</button></div>
        </div>
    </div>
    <div class="message">
        <div class="message-header">
            <div class="columns" style="width: 100%;">
                <div class="column">
                    <span class="title is-5">{% mdicon settings %}Motor Configuration</span>
                </div>
                <div class="column is-one-third has-text-right">
                    <input class="is-checkradio is-white" id="profile-enable" type="checkbox" v-model="preset.enable" />
                    <label for="profile-enable"><strong>Enable Profile Presets</strong></label>
                </div>
            </div>
        </div>
        <div class="message-body">
            <div class="columns is-multiline">
                <!-- Overcurrent -->
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">Over Current:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" v-model="ocd" min="0" max="1000" step="50" /></span>
                                <span class="control"><span class="button is-static">mV</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_ocd }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label">&nbsp;</div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control">
                                    <span class="button is-label">
                                        <input class="is-checkradio is-white" id="ocd-shutdown" type="checkbox" v-model="ocdshutdown" />
                                        <label class="is-checkradio-label" for="ocd-shutdown"><strong>Over Current Shutdown</strong></label>
                                    </span>
                                </span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_ocdshutdown }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="columns is-multiline">
                <!-- Min / Max Speed -->
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">Max Speed:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" v-model="maxspeed" /></span>
                                <span class="control"><span class="button is-static">steps/s</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_maxspeed }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">Min Speed:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" v-model="minspeed" /></span>
                                <span class="control"><span class="button is-static">steps/s</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_minspeed }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accel / Decel -->
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">Acceleration:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" v-model="accel" min="0" step="50" /></span>
                                <span class="control"><span class="button is-static">steps/s<sup>2</sup></span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_accel }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">Deceleration:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" v-model="decel" min="0" step="50" /></span>
                                <span class="control"><span class="button is-static">steps/s<sup>2</sup></span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_decel }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="columns is-multiline">
                <!-- KT Vals -->
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">KT Hold:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" min="0" max="1" step="0.1" v-model="kthold" /></span>
                                <span class="control"><span class="button is-static">%</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_kthold }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">KT Run:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" min="0" max="1" step="0.1" v-model="ktrun" /></span>
                                <span class="control"><span class="button is-static">%</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_ktrun }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">KT Accel:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" min="0" max="1" step="0.1" v-model="ktaccel" /></span>
                                <span class="control"><span class="button is-static">%</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_ktaccel }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">KT Decel:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" min="0" max="1" step="0.1" v-model="ktdecel" /></span>
                                <span class="control"><span class="button is-static">%</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_ktdecel }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="columns is-multiline">
                <!-- Full Step Speed and Boost Mode-->
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">Full Step Speed:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" min="7.63" max="15625" step="100" v-model="fsspeed" /></span>
                                <span class="control"><span class="button is-static">steps/s</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_fsspeed }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label">&nbsp;</div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control">
                                    <span class="button is-label">
                                        <input class="is-checkradio is-white" id="fsboost-enable" type="checkbox" v-model="fsboost" />
                                        <label class="is-checkradio-label" for="fsboost-enable"><strong>Boost Mode</strong></label>
                                    </span>
                                </span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_fsboost }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="subtitle is-5" style="padding-left: 1rem;">Current Mode Settings:</div>
            <div class="columns is-multiline">
                <!-- Switching Period-->
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">Switching Period:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" min="4" max="124" step="4" v-model="cm_switchperiod" /></span>
                                <span class="control"><span class="button is-static">&mu;s</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_cm_switchperiod }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="subtitle is-5" style="padding-left: 1rem;">Voltage Mode Settings:</div>
            <div class="columns is-multiline">
                <!-- PWM Freqency-->
                <div class="column is-half">
                    <div class="field is-horizontal">
                        <div class="field-label is-normal"><label class="label">PWM Frequency:</label></div>
                        <div class="field-body">
                            <div class="field has-addons">
                                <span class="control"><input class="input" type="number" min="5" max="70" step="1" v-model="vm_pwmfreq" /></span>
                                <span class="control"><span class="button is-static">&mu;s</span></span>
                                <span class="control"><button class="is-help button tooltip is-tooltip-left is-tooltip-multiline" data-tooltip="{{ help_vm_pwmfreq }}">{% mdicon help-circle, .baseline, .inline %}</button></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="field is-grouped is-grouped-right">
                <span class="control">
                    <input class="is-checkradio is-white" id="eeprom-save" type="checkbox" v-model="save" />
                    <label for="eeprom-save" style="top: 0.7rem;"><strong>EEPROM Save</strong></label>
                </span>
                <span class="control">
                    <button class="button is-medium is-primary" v-on:click="writemotor(null)" v-bind:disabled="!hiz || !initialload">Write</button>
                </span>
                <span class="control">
                    <button class="button is-medium is-light" v-on:click="readmotor(false)" v-bind:disabled="!hiz || !initialload">Read</button>
                </span>
            </div>
            <div v-if="!hiz" class="help has-text-right">Only available when motor is not running.</div>
            <div v-if="!initialload" class="help has-text-right">Only available after configuration data loaded.</div>
        </div>
    </div>
    <div class="message">
        <div class="message-header">
            <div class="columns" style="width: 100%;">
                <div class="column">
                    <span class="title is-5">{% mdicon console %}Quick Code</span>
                </div>
                <div class="column is-one-third has-text-right">
                    <ul class="header-tabs">
                        <li><a v-bind:class="{'is-active': code.language == 'bash'}" v-on:click="code.language = 'bash'">Bash</a></li>
                        <li><a v-bind:class="{'is-active': code.language == 'python'}" v-on:click="code.language = 'python'">Python</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="message-body" style="position: relative;">
<pre style="display: none;" id="code-bash">{% raw %}
# Using curl for network and jq for json parsing
HOST="{{ browser.hostname }}.local"  # or "{{ wifi.ip }}"
PROTOCOL="http"  # or https

# Ping motor api
curl -sS "${PROTOCOL}://${HOST}/api/ping" | jq
# All successful api calls will return 'status: ok'. This means
#  that the command was successfully interpreted and executed.
#  However, errors may still be thrown during execution.

# Write motor configuration
MODE="{{ mode }}"
STEPSIZE="{{ stepsize }}"
OCD="{{ ocd }}"
OCDSHUTDOWN="{{ ocdshutdown }}"
MAXSPEED="{{ maxspeed }}"
MINSPEED="{{ minspeed }}"
ACCEL="{{ accel }}"
DECEL="{{ decel }}"
KTHOLD="{{ kthold }}"
KTRUN="{{ ktrun }}"
KTACCEL="{{ ktaccel }}"
KTDECEL="{{ ktdecel }}"
FSSPEED="{{ fsspeed }}"
FSBOOST="{{ fsboost }}"
CM_SWITCHPERIOD="{{ cm_switchperiod }}"
VM_PWMFREQ="{{ vm_pwmfreq }}"
REVERSE="{{ reverse }}"
SAVE_EEPROM="{{ save }}"
curl -sS "${PROTOCOL}://${HOST}/api/motor/set?\
mode=${MODE}&stepsize=${STEPSIZE}&\
ocd=${OCD}&ocdshutdown=${OCDSHUTDOWN}&\
maxspeed=${MAXSPEED}&minspeed=${MINSPEED}&accel=${ACCEL}&decel=${DECEL}&\
kthold=${KTHOLD}&ktrun=${KTRUN}&ktaccel=${KTACCEL}&ktdecel=${KTDECEL}&\
fsspeed=${FSSPEED}&fsboost=${FSBOOST}&\
cm_switchperiod=${CM_SWITCHPERIOD}&\
vm_pwmfreq=${VM_PWMFREQ}&\
reverse=${REVERSE}&save=${SAVE_EEPROM}" | jq

# Read motor configuration
curl -sS "${PROTOCOL}://${HOST}/api/motor/get" | jq
# Returns object with keys: mode, stepsize, maxspeed, minspeed, accel, decel,
#   kthold, ktrun, ktaccel, ktdecel, fsspeed, fsboost, reverse

# Zero position
curl -sS "${PROTOCOL}://${HOST}/api/motor/pos/reset" | jq

# Send servo command
POSITION="{{ setpos }}"  # ANGLE / 360 * 200 * STEPSIZE; ANGLE={{ setangle }}, STEPSIZE={{ stepsize }}
curl -sS "${PROTOCOL}://${HOST}/api/motor/command/goto?position=${POSITION}" | jq

# Send speed command
STEPS_PER_SEC="{{ setstepss }}"  # RPM / 60 * 200; RPM={{ setrpm }}
DIRECTION="{{ setdirection }}"
STOPSWITCH="{{ speed.stopswitch }}"
curl -sS "${PROTOCOL}://${HOST}/api/motor/command/run?stepss=${STEPS_PER_SEC}&\
direction=${DIRECTION}&stopswitch=${STOPSWITCH}" | jq

# Send stepclock command
DIRECTION="{{ setdirection }}"
curl -sS "${PROTOCOL}://${HOST}/api/motor/command/stepclock?direction=${DIRECTION}" | jq

# Stop
STOP_BRIDGE="{{ speed.hiz? 'hiz' : 'stop' }}"
STOP_SOFT="true"
curl -sS "${PROTOCOL}://${HOST}/api/motor/command/${STOP_BRIDGE}?soft=${STOP_SOFT}" | jq

# Read status
curl -sS "${PROTOCOL}://${HOST}/api/motor/status" | jq
# Returns object with keys: direction, movement, hiz, busy, switch,
#   flags:{ switch, commanderror, overcurrent, undervoltage, thermalwarning,
#   thermalshutdown, stalldetect }

# Read state
curl -sS "${PROTOCOL}://${HOST}/api/motor/state" | jq
# Returns object with keys: position, mark, speed, busy

{% endraw %}</pre>
<pre style="display: none;" id="code-python">{% raw %}
from goodrobotics import WSX100 as WifiStepper

host = "{{ browser.hostname }}.local"  # or "{{ wifi.ip }}"
protocol = WifiStepper.HTTP  # or HTTPS, CRYPTO
username = None # Required when auth enabled
password = None
MOTOR = WifiStepper(host, protocol)
if not MOTOR.connect(username, password):
    raise Exception('Failed to connect')

# Write configuration
MOTOR.writeConfig(
    mode='{{ mode }}', stepsize={{ stepsize }},
    maxspeed={{ maxspeed }}, minspeed={{ minspeed }}, accel={{ accel }}, decel={{ decel }},
    kthold={{ kthold }}, ktrun={{ ktrun }}, ktaccel={{ ktaccel }}, ktdecel={{ ktdecel }},
    fsseed={{ fsspeed }}, fsboost={{ fsboost | pybool }},
    reverse={{ reverse | pybool }}, save={{ save | pybool }}
)

# Read configuration
config = MOTOR.readConfig()
# config is a dict() with keys: mode, stepsize, maxspeed, minspeed, accel, decel,
#   kthold, ktrun, ktaccel, ktdecel, fsspeed, fsboost, reverse

# Zero servo position


# Send servo command


# Send speed command


# Stop motor
MOTOR.stop(bridge={{ !speed.hiz | pybool }}, soft=True)

# Read status
status = MOTOR.getStatus()
# status is a dict() with keys: direction, movement, hiz, busy, switch,
#   flags=dict( switch, commanderror, overcurrent, undervoltage, thermalwarning,
#   thermalshutdown, stalldetect )

# Read state
state = MOTOR.getState()
# state is a dict() with keys: [TODO LIST KEYS!]

{% endraw %}</pre>
            <button class="button is-primary" id="code-copy" style="position: absolute; top: 35px; right: 50px;">{% mdicon content-copy, .baseline %}Copy</button>
            <pre v-bind:style="code.language == 'bash'? {} : {'display': 'none'}" class="code"><code class="language-bash" id="code-bash-render"></code></pre>
            <pre v-bind:style="code.language == 'python'? {} : {'display': 'none'}" class="code"><code class="language-python" id="code-python-render"></code></pre>
        </div>
    </div>
</div>
<script>
    // Websocket
    var socket = (function() {
        var sock = new WebSocket('{{ site.wsurl }}:81');
        sock.binaryType = "arraybuffer";
        sock.onmessage = function(message) {
            var v = new DataView(message.data);
            if (v.getUint8(0) == 0x11) {
                // Read status reply
                app.getdirection = v.getUint8(1) == 0x66? 'forward' : 'reverse';
                switch (v.getUint8(2)) {
                    case 0x78:      app.movement = 'idle';          break;
                    case 0x61:      app.movement = 'accelerating';  break;
                    case 0x64:      app.movement = 'decelerating';  break;
                    case 0x73:      app.movement = 'spinning';      break;
                }
                app.hiz = v.getUint8(3) == 0x1;
                app.busy = v.getUint8(4) == 0x1;
                app.switch = v.getUint8(5) == 0x1;
                app.stepclock = v.getUint8(6) == 0x1;
                app.flags.commanderror = v.getUint8(7) == 0x1;
                app.flags.overcurrent = v.getUint8(8) == 0x1;
                app.flags.undervoltage = v.getUint8(9) == 0x1;
                app.flags.thermalshutdown = v.getUint8(10) == 0x1;
                app.flags.thermalwarning = v.getUint8(11) == 0x1;
                app.flags.stalldetect = v.getUint8(12) == 0x1;
                app.flags.switch = v.getUint8(13) == 0x1;

            } else if (v.getUint8(0) == 0x12) {
                // Read state reply
                app.busy = v.getUint8(13) == 0x1;
                app.getrpm = v.getFloat32(9, true) * 60 / 200;
                app.getangle = v.getInt32(1, true) / 200 / app.stepsize * 360;
            }
        }

        return {
            send: function(ba) {
                if (sock.readyState != sock.OPEN) {
                    return false;
                }
                sock.send(ba);
                return true;
            }
        };
    })();

    // Vue
    function merge(src, dest, keys, round) {
        for (i in keys) {
            var v = src[keys[i]];
            if (round && round[i]) v = Math.round(v / round[i]) * round[i];
            dest[keys[i]] = v;
        }
    }

    function throttle(func, delay, check) {
        var onindex = 0;
        var lastcall = 0
        return function() {
            var context = this, args = arguments;
            var myindex = ++onindex;

            var checkfunc = function() {
                if (onindex != myindex) return;
                var now = new Date().getTime();
                if ((now - lastcall) >= delay) {
                    lastcall = now;
                    func.apply(context, args);
                } else {
                    setTimeout(checkfunc, check);
                }
            }
            checkfunc();
        }
    }

    var app = new Vue({
        el: '#profiles',
        data: {
            profile: 'none',
            preset: {
                enable: true,
                size: 'nema-17',
                voltage: 24
            },
            mode: 'voltage',
            protocol: 'ws',
            flags: {
                switch: false,
                commanderror: false,
                overcurrent: false,
                undervoltage: false,
                thermalwarning: false,
                thermalshutdown: false,
                stalldetect: false
            },
            servo: {
            },
            speed: {
                hiz: true,
                stopswitch: false
            },
            extstepclock: {
                stepreverse: false
            },

            setdirection: 'forward',
            setrpm: 30,
            setangle: 0,

            getdirection: '?',
            getrpm: 0,
            getangle: 0,

            initialload: false,
            stepsize: 1,
            ocd: 0,
            ocdshutdown: false,
            maxspeed: 0,
            minspeed: 0,
            accel: 0,
            decel: 0,
            kthold: 0.0,
            ktrun: 0.0,
            ktaccel: 0.0,
            ktdecel: 0.0,
            fsspeed: 0,
            fsboost: false,
            cm_switchperiod: 0,
            vm_pwmfreq: 0,
            save: true,

            reverse: false,
            movement: '',
            hiz: true,
            busy: false,
            switch: false,
            stepclock: false,
            voltage: '?',
            adc: 0,

            code:  {
                language: 'bash'
            },
            browser: {
                hostname: '<hostname>'
            },
            wifi: {
                ip: '<ip>'
            }
        },
        computed: {
            setpos: function() {
                return Math.round(this.setangle / 360 * 200 * this.stepsize);
            },
            setstepss: function() {
                return this.setrpm / 60 * 200;
            }
        },
        watch: {
            profile: function(newv, oldv) {
                if (newv != oldv) {
                    this.writestop(true, false);
                }

                if (newv == 'servo') {
                    this.writeresetpos();
                }
            },
            stepsize: function(newv, oldv) {
                if (newv != oldv) {
                    this.writeresetpos();
                }
            },
            setangle: function(newv) {
                this.writeservo();
            },
            setrpm: function(newv) {
                this.writespeed(this.setdirection);
            },
            reverse: function(newv) {
                this.writemotor(['reverse'])
            }
        },
        methods: {
            animate: function() {
                if (this.profile == 'speed' && this.getrpm > 0) {
                    this.getangle += this.getrpm / 60 / 30 * 360 * (this.setdirection == 'reverse'? -1 : 1);
                }
            },
            updatepreset: function() {
                if (this.preset.enable) {
                    // TODO
                }
                if (this.mode == 'current' && this.stepsize > 16) {
                    this.stepsize = 16;
                }
                this.writemotor(null);
            },
            updatemode: function() {
                this.writemotor(['mode']);
                this.updatepreset();
            },
            updatecode: function() {
                if (this.code.language == 'bash') {
                    var src = document.getElementById('code-bash');
                    var dst = document.getElementById('code-bash-render');
                    dst.textContent = src.textContent;
                    Prism.highlightElement(dst);

                } else if (this.code.language == 'python') {
                    var src = document.getElementById('code-python');
                    var dst = document.getElementById('code-python-render');
                    dst.textContent = src.textContent;
                    Prism.highlightElement(dst);
                }
            },
            readstatus: function(clearerrors) {
                if (this.protocol == 'ws') {
                    var ba = new ArrayBuffer(2);
                    var v = new DataView(ba);
                    v.setUint8(0, 0x11);
                    v.setUint8(1, clearerrors? 0x01 : 0x0);
                    socket.send(ba);

                } else if (this.protocol == 'http') {
                    axios.get("{{ site.apiurl }}/api/motor/status", {params: {clearerrors: clearerrors}}).then(function (r) {
                        if (r.data.status == 'ok') {
                            app.getdirection = r.data.direction;
                            merge(r.data, app, ['movement', 'hiz', 'busy', 'switch', 'stepclock']);
                            merge(r.data.alarms, app.flags, ['switch', 'commanderror', 'overcurrent', 'undervoltage', 'thermalwarning', 'thermalshutdown', 'stalldetect']);
                        }
                    });
                }
            },
            readstate: function() {
                if (this.protocol == 'ws') {
                    var ba = new ArrayBuffer(1);
                    var v = new DataView(ba);
                    v.setUint8(0, 0x12);
                    socket.send(ba);

                } else if (this.protocol == 'http') {
                    axios.get("{{ site.apiurl }}/api/motor/state").then(function (r) {
                        if (r.data.status == 'ok') {
                            app.busy = r.data.busy;
                            app.getrpm = r.data.stepss * 60 / 200;
                            app.getangle = r.data.position / 200 / app.stepsize * 360;
                        }
                    });
                }
            },
            readmotor: function(cached) {
                axios.get("{{ site.apiurl }}/api/motor/get", {params: {cached: cached}}).then(function (r) {
                    if (r.data.status == 'ok') {
                        merge(r.data, app,
                            ['mode', 'stepsize', 'ocd', 'ocdshutdown', 'maxspeed', 'minspeed', 'accel', 'decel', 'kthold', 'ktrun', 'ktaccel', 'ktdecel', 'fsspeed', 'fsboost', 'cm_switchperiod', 'vm_pwmfreq', 'reverse'],
                            [null, null, 20, null, 20, 20, 10, 10, 0.01, 0.01, 0.01, 0.01, 20, null, 4, 0.01, null]
                        );
                        app.initialload = true;
                    }
                });
            },
            writemotor: function(keys) {
                keys = keys || ['maxspeed', 'minspeed', 'accel', 'decel', 'kthold', 'ktrun', 'ktaccel', 'ktdecel', 'fsspeed', 'cm_switchperiod', 'vm_pwmfreq', 'fsboost'];
                var params = {};
                merge(this, params, keys.concat(['save']));
                axios.get("{{ site.apiurl }}/api/motor/set", {params: params});
            },
            readadc: function() {
                axios.get("{{ site.apiurl }}/api/motor/adc").then(function (r) {
                    if (r.data.status == 'ok') {
                        var v = r.data.value;
                        var diffs = [Math.abs(12-v), Math.abs(24-v), Math.abs(48-v), Math.abs(50-v)];
                        var index = diffs.indexOf(Math.min(diffs[0], diffs[1], diffs[2], diffs[3]));
                        app.voltage = Math.round(v);
                        app.preset.voltage = [12, 24, 48, 50][index];
                    }
                });
            },
            writestop: function(hiz, soft) {
                if (this.protocol == 'ws') {
                    var ba = new ArrayBuffer(2);
                    var v = new DataView(ba);
                    v.setUint8(0, hiz? 0x22 : 0x21);
                    v.setUint8(1, 0x01);
                    socket.send(ba);

                } else if (this.protocol == 'http') {
                    axios.get("{{ site.apiurl }}/api/motor/command/" + (hiz? "hiz" : "stop"), {params: {soft: soft}});
                }
            },
            writeresetpos: function() {
                if (this.protocol == 'ws') {
                    var ba = new ArrayBuffer(5);
                    var v = new DataView(ba);
                    v.setUint8(0, 0x31);
                    v.setInt32(1, 0, true);
                    socket.send(ba);

                } else if (this.protocol == 'http') { 
                    axios.get("{{ site.apiurl }}/api/motor/pos/reset");
                }
                this.getangle = 0;
            },
            writeservo: throttle(function() {
                if (this.protocol == 'ws') {
                    var ba = new ArrayBuffer(5);
                    var v = new DataView(ba);
                    v.setUint8(0, 0x23);
                    v.setInt32(1, this.setpos, true);
                    socket.send(ba);

                } else if (this.protocol == 'http') { 
                    axios.get("{{ site.apiurl }}/api/motor/command/goto", {params: {position: this.setpos}});
                }
            }, 250, 30),
            writespeed: throttle(function(direction) {
                this.setdirection = direction;

                if (this.protocol == 'ws') {
                    var ba = new ArrayBuffer(7);
                    var v = new DataView(ba);
                    v.setUint8(0, 0x24);
                    v.setUint8(1, this.setdirection == 'forward'? 0x66 : 0x72);
                    v.setFloat32(2, this.setstepss, true);
                    v.setUint8(6, this.speed.stopswitch? 0x01 : 0x0);
                    socket.send(ba);
                } else if (this.protocol == 'http') {
                    axios.get("{{ site.apiurl }}/api/motor/command/run", {params: {stepss: this.setstepss, direction: this.setdirection, stopswitch: this.stopswitch}});
                }
            }, 250, 100),
            writestepclock: throttle(function() {
                this.setdirection = this.extstepclock.stepreverse ? 'reverse' : 'forward';

                if (this.protocol == 'ws') {
                    var ba = new ArrayBuffer(2);
                    var v = new DataView(ba);
                    v.setUint8(0, 0x25);
                    v.setUint8(1, this.setdirection == 'forward'? 0x66 : 0x72);
                    socket.send(ba);

                } else if (this.protocol == 'http') {
                    axios.get("{{ site.apiurl }}/api/motor/command/stepclock", {params: {direction: this.setdirection}});
                }
            }, 1000, 100)
        },
        filters: {
            capitalize: function(s) {
                return s.charAt(0).toUpperCase() + s.slice(1);
            },
            pybool: function(v) {
                if (v.toString() == 'true') return 'True';
                if (v.toString() == 'false') return 'False';
                return v;
            }
        },
        mounted: function () {
            var pollstatus = function() {
                this.readstatus();
                setTimeout(pollstatus, 500);
            }.bind(this);

            var pollstate = function() {
                this.readstate();
                setTimeout(pollstate, 300);
            }.bind(this);

            setInterval(function() {
                this.animate();
            }.bind(this), 33);

            this.readmotor(false);
            this.readadc();
            pollstatus();
            pollstate();

            axios.get("{{ site.apiurl }}/api/browser/get").then(function (r) {
                if (r.data.status == 'ok') {
                    merge(r.data, app.browser, ['hostname']);
                }
            });

            axios.get("{{ site.apiurl }}/api/wifi/get").then(function (r) {
                if (r.data.status == 'ok') {
                    merge(r.data, app.wifi, ['ip']);
                }
            });

            this.updatecode();
        },
        updated: function() {
            this.updatecode();
        }
    });

    // Servo svg
    function unwrap(newv, oldv) {
        var a = Math.sign(oldv - newv) * 360;
        while (Math.abs(oldv - newv) > 180) {
            newv += a;
        }
        return newv;
    }

    function servodrag(svg, evt) {
        var bounds = svg.getBoundingClientRect();
        var x = evt.clientX - (bounds.left + bounds.width / 2);
        var y = evt.clientY - (bounds.top + bounds.height / 2);
        app.setangle = Math.round(100 * unwrap(Math.atan2(-x, -y) * 180 / Math.PI, app.setangle)) / 100;
    }

    var dragging = false;
    var servosvg = document.getElementById("servosvg");
    servosvg.addEventListener("mousedown", function(e) {
        dragging = true;
        servodrag(servosvg, e);
    });
    servosvg.addEventListener("mousemove", function(e) {
        if (dragging) servodrag(servosvg, e);
    });
    
    servosvg.addEventListener("mouseup", function(e) {
        dragging = false;

    });
    /*
    servosvg.addEventListener("mouseleave", function(e) {
        dragging = false;
    });
    */

    // Clipboard
    new ClipboardJS('#code-copy', {
        text: function(trigger) {
            if (app.code.language == 'bash')    return document.getElementById('code-bash').textContent;
            if (app.code.language == 'python')  return document.getElementById('code-python').textContent;
            return "";
        }
    });
</script>
